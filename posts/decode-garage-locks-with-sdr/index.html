<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.6d82a24cc2891ca3975f.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 3.6.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">使用SDR解码车库门遥控器</title><link as="script" rel="preload" href="/webpack-runtime-6297b2490187ca149114.js"/><link as="script" rel="preload" href="/framework-c49643cdc45c711b03f2.js"/><link as="script" rel="preload" href="/app-118d572cd869901a0cca.js"/><link as="script" rel="preload" href="/commons-58c1bc502bb104b98de6.js"/><link as="script" rel="preload" href="/9cd0995e6c29d39781f2bca8f8112839edc31759-14ea84608eacde5884c7.js"/><link as="script" rel="preload" href="/f324a553e1a680902fe4138d7dfd3402fe2be890-3373d120107ceb1986e9.js"/><link as="script" rel="preload" href="/component---src-templates-posts-tsx-d36dd1836dc2901206b1.js"/><link as="fetch" rel="preload" href="/page-data/posts/decode-garage-locks-with-sdr/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 12fqop5">.css-12fqop5{min-height:100px;padding-bottom:30px;overflow:hidden;margin-top:50px;}</style><main class="css-12fqop5 efj0oce0"><style data-emotion="css 1a3lhd6">.css-1a3lhd6{position:fixed;top:0;height:50px;width:100%;background-color:#fff;box-shadow:0 0 20px rgba(0, 0, 0, 0.05);}</style><header class="css-1a3lhd6 e1r0w5h10"><style data-emotion="css a4g47f">.css-a4g47f{display:inline-block;color:#4b5cc4;font-size:20px;margin-bottom:16px;margin-left:50px;text-transform:uppercase;}</style><h1 class="css-a4g47f e1lhkcml0">Lingxiao</h1><style data-emotion="css 18qfn0e">.css-18qfn0e{float:right;font-size:16px;margin-right:40px;}</style><nav class="css-18qfn0e exwcla13"><style data-emotion="css qr8q5p">.css-qr8q5p{list-style:none;}</style><ul class="css-qr8q5p exwcla12"><style data-emotion="css 5l0uu3">.css-5l0uu3{display:inline;}.css-5l0uu3+.css-5l0uu3{margin-left:15px;}</style><li class="css-5l0uu3 exwcla11"><style data-emotion="css ap4ird">.css-ap4ird{-webkit-text-decoration:none;text-decoration:none;color:#4b5cc4;}.css-ap4ird:focus,.css-ap4ird:hover,.css-ap4ird:visited,.css-ap4ird:link,.css-ap4ird:active{-webkit-text-decoration:none;text-decoration:none;color:#4b5cc4;}</style><a class="css-ap4ird exwcla10" href="/news">新闻</a></li><li class="css-5l0uu3 exwcla11"><a class="css-ap4ird exwcla10" href="/memories">旧事</a></li><li class="css-5l0uu3 exwcla11"><a class="css-ap4ird exwcla10" href="/about">关于</a></li></ul></nav></header><style data-emotion="css b2mis5">.css-b2mis5{margin:2% 16.25% 5% 16.25%;}</style><div width="1000" class="css-b2mis5 efj0oce1"><style data-emotion="css 5hw1lk">.css-5hw1lk{margin:0px;padding-bottom:20px;color:#2e4e7e;}</style><h1 class="css-5hw1lk e1hzbuke0">使用SDR解码车库门遥控器</h1><div><p>之前，家里的院门换了一个可以遥控开关的推拉门。我妈念叨着要是忘了钥匙，也没带遥控器怎么办，要是这扇门能一喊就开就好了。我想着要是能知道遥控器和门之间的通讯协议，那我是不是也可以自己发送相应的数据，用来自动控制。正好家里有一个之前买的RTL-SDR，可以用来监听电磁信号，姑且拿它来试一试。</p>
<h2>遥控器</h2>
<p>看了看家中车库门和大门的遥控器，上面各有4个键，一个是开门键，一个是关门键，还有另外两个并不知道是什么功能。</p>
<p><img src="../assets/garage_locks/garage-keys.jpg" alt="garage-keys"/></p>
<p>查了查网络上的资料，有人做过类似的<a href="https://medium.com/@eoindcoolest/decoding-a-garage-door-opener-with-an-rtl-sdr-5a47292e2bda#.qu46ncrr3">调查</a>。一般来说这样的遥控器工作在433MHz左右的频率，内部使用直列的拨片开关（DIP Switch）控制每一个按键所发射的信号值。这些信号值会经过编码的过程之后调制在433MHz的电磁载波上发射出去。从维基百科的<a href="https://en.wikipedia.org/wiki/LPD433">LPD433</a>的页面上来看，在这个频段上发射接收信号在大部分国家是不需要申请许可的，主要用于发射功率不超过10mW的低功耗设备进行通讯。这类遥控器会使用最简单的<a href="https://zh.wikipedia.org/wiki/OOK">开关键控（OOK）</a>的方式将发送数据的莫尔斯码调制到载波上。</p>
<h2>软件无线电（Software Defined Radio）</h2>
<p>之前买过一个RTL-SDR，是一个低成本的软件无线电，价格在60到100元不等。可以用USB接到电脑上用软件（如Gnu Radio）监听空气中的无线电信号。RTL-SDR工作的频率范围在25MHz到1.76GHz，所以针对433MHz附近的载波频率应该是没有问题的。</p>
<p><img src="../assets/garage_locks/rtl-sdr.jpg" alt="rtl-sdr"/></p>
<p>通讯中的信号都可以用如下的式子进行表示：$f(t)=A(t)\sin(2\pi f_ct+\phi(t))$。其中$A(t)$是我们调制在载波幅度上的信号，而$\phi(t)$则是调制在载波相位上的信号，$f_c$是载波频率。我们将这样的式子进行分解可以得到：$f(t)=A(t)\cos(\phi(t))\sin(2\pi f_ct) + A(t)\sin(\phi(t))\cos(2\pi f_ct)$，令$i(t) = A(t)\cos(\phi(t))$和$q(t)=A(t)\sin(\phi(t))$，就有$f(t)=i(t)\sin(2\pi f_ct) + q(t)\cos(2\pi f_ct)$。SDR里面采集的信号被称为I/Q信号，就是上式所示的$i(t)$和$q(t)$。通过I/Q信号就可以还原出原始用于调制的基带信号$A(t)=\sqrt{i^2(t) + q^2(t)}$和$\phi(t)=\arctan{\frac{q(t)}{i(t)}}$。</p>
<h2>中心频率</h2>
<p>首先要确定遥控器所使用的中心频率。安装好Gnu Radio之后，在终端里面输入<code>osmocom_fft -F -f 433e6 -s 4e6</code>，打开频谱监视图，按下遥控器对应按钮的按键，观察频谱图的变化。</p>
<p><img src="../assets/garage_locks/spectrum.png" alt="spectrum"/></p>
<p>从频谱图上可以看到，按下按钮之后在432.95MHz的频点上有较大的峰值，我们猜想这个遥控器所使用的载波频率就是432.95MHz。</p>
<h2>录制与分析信号</h2>
<p>确定了中心频率之后，打开Gnu Radio，绘制录制框图如下：</p>
<p><img src="../assets/garage_locks/record_diagram.png" alt="record_diagram"/></p>
<p>左边的框图的作用是以432.95MHz的载波频率解调接收到的电磁波，即上文中提到的I/Q信号，将其发送到右边的显示接口（GUI Sink）将其保存下来（File Sink）。</p>
<p>打开录制好的信号文件，用Python将其基带信号的幅值，即$A(t)$显示如下图：</p>
<p><img src="../assets/garage_locks/raw_signal.png" alt="raw_signal"/></p>
<p>当按下按键之后，遥控器会一直向外重复发送同样的信号，每次发送之间都有一些较长的间隔。我们可以认为这个间隔之间即是我们想要的信号。将录制好的信号放大拉宽，用红色的线标识出其发生变化的时间如下图。从图上可以比较明显的看出这是一个数字信号，与我们之前查找资料时遥控器采用的OOK方式的猜想相符。</p>
<p><img src="../assets/garage_locks/raw_signal_zoom.png" alt="raw_signal_zoom"/></p>
<p>将上面的信号转换成二进制则为1000100011101000111010001000111010001110111010001000100010001110111011101110111010001000100011101。</p>
<p>利用<a href="https://en.wikipedia.org/wiki/Morse_code">莫尔斯码表</a>可以转换成：EENNENGEEE？EEN</p>
<h2>总结</h2>
<p>本来想用录下来的信号进行重放，看看是不是真的能够打开大门。不过试了几次都门都没有任何反应。后来查了下文档才发现，RTL-SDR使用的Realtek 2832的芯片是一个DVB的解码器，并不带有发射的功能。重放的功能暂此作罢。之后再去搞一个HackRF或者RFcat来试试。</p>
<p>不过不论怎么说，车库门或者大门使用这么简单的无线方案谈不上安全。虽然用于遥控的数据长度是足够的，10几位的英文字母加数字对于暴力破解还是有比较高的门槛的。不过，这样的方案不能防止重放攻击。只要我录下了别人的某一次开门关门时的信号，或者知道上述破解出来的英文字符，就相当于掌握了这扇门的开关钥匙。所以还是小心为妙啊。</p>
<h2>Reference</h2>
<p><a href="https://medium.com/@eoindcoolest/decoding-a-garage-door-opener-with-an-rtl-sdr-5a47292e2bda#.qu46ncrr3">Decoding a garage door opener with an RTL-SDR | by Eoin | Medium</a></p>
<p><a href="https://en.wikipedia.org/wiki/In-phase_and_quadrature_components">In-phase and quadrature components - Wikipedia</a></p>
<p><a href="https://en.wikipedia.org/wiki/LPD433">LPD433 - Wikipedia</a></p>
<p><a href="https://en.wikipedia.org/wiki/On%E2%80%93off_keying">On–off keying - Wikipedia</a></p>
<p><a href="https://en.wikipedia.org/wiki/Morse_code">Morse code - Wikipedia</a></p></div></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/decode-garage-locks-with-sdr/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8eb7433d0cb153530031.js"],"app":["/app-118d572cd869901a0cca.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-127fb9a243dfe67e9105.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-c0f984a49186f552583a.js"],"component---src-pages-memories-tsx":["/component---src-pages-memories-tsx-be1fe543e13cd2fd44aa.js"],"component---src-pages-news-tsx":["/component---src-pages-news-tsx-4f08e24c501230a8913c.js"],"component---src-templates-posts-tsx":["/component---src-templates-posts-tsx-d36dd1836dc2901206b1.js"]};/*]]>*/</script><script src="/polyfill-8eb7433d0cb153530031.js" nomodule=""></script><script src="/component---src-templates-posts-tsx-d36dd1836dc2901206b1.js" async=""></script><script src="/f324a553e1a680902fe4138d7dfd3402fe2be890-3373d120107ceb1986e9.js" async=""></script><script src="/9cd0995e6c29d39781f2bca8f8112839edc31759-14ea84608eacde5884c7.js" async=""></script><script src="/commons-58c1bc502bb104b98de6.js" async=""></script><script src="/app-118d572cd869901a0cca.js" async=""></script><script src="/framework-c49643cdc45c711b03f2.js" async=""></script><script src="/webpack-runtime-6297b2490187ca149114.js" async=""></script></body></html>